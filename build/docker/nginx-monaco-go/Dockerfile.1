FROM mohamedbana/monaco-go:145a117

ENV DOMAIN_NAME_TOP="bana.io"
ENV DOMAIN_NAME_SUB="cloud"
ENV DOMAIN_FULL="$DOMAIN_NAME_SUB.$DOMAIN_NAME_TOP"
ENV DOMAIN_SUB_FOLDER="$DOMAIN_NAME_TOP/$DOMAIN_NAME_SUB"
ENV LOG_PATH_PREFIX="/var/log/nginx/$DOMAIN_SUB_FOLDER"

ENV SSL_CERTIFICATE="/etc/nginx/certs/$DOMAIN_SUB_FOLDER/cert.pem"
ENV SSL_CERTIFICATE_KEY="/etc/nginx/certs/$DOMAIN_SUB_FOLDER/cert.key"
RUN echo " \
-------------------- \
         DOMAIN_FULL: $DOMAIN_FULL \
   DOMAIN_SUB_FOLDER: $DOMAIN_SUB_FOLDER \
     SSL_CERTIFICATE: $SSL_CERTIFICATE \
 SSL_CERTIFICATE_KEY: $SSL_CERTIFICATE_KEY \
--------------------"

# Install Nginx.
RUN \
  add-apt-repository -y ppa:nginx/stable

RUN \
  apt-get update -qq -y && \
  apt-get upgrade -qq -y

# apt-get upgrade -qq -y

RUN apt-get install -qq -y \
  nginx

# RUN \
#   rm -rf /var/lib/apt/lists/* && \
#   echo -e "\ndaemon off;" >> /etc/nginx/nginx.conf && \
#   chown -R www-data:www-data /var/lib/nginx

# # verify it has http/2 and a version i tested under
# RUN \
#   (nginx -V 2>&1 | grep 'http_v2') && \
#   (nginx -v 2>&1 | grep 'nginx/1.10.2') && \
#   (nginx -h; nginx -t; exit 0)

# RUN mkdir -p \
#   /var/run \
# 	/var/log/nginx/$DOMAIN_SUB_FOLDER \
# 	/etc/nginx/certs/$DOMAIN_SUB_FOLDER \
# 	/var/www/html/$DOMAIN_SUB_FOLDER

# RUN \
#   [ -n "$_" ] && \
# 	cd /var/www/html/$DOMAIN_SUB_FOLDER && \
# 	ln -s $HOME/monaco-go monaco-go && \
# 	ls -lah && ls -lah monaco-go

# # Define mountable directories
# VOLUME ["/etc/nginx/sites-enabled", "/etc/nginx/certs", "/etc/nginx/conf.d", "/var/log/nginx", "/var/www/html", "/entry"]

# Define working directory.
# WORKDIR /etc/nginx

# VOLUME ["/Users/mbana/monaco-go"]

# Expose ports.
ENV LANGSERVER_PORT "4389"
EXPOSE 80 443
# EXPOSE $LANGSERVER_PORT

# COPY ./build/docker/docker-entrypoint.sh /docker-entrypoint.sh
# RUN chmod +x /docker-entrypoint.sh

SHELL ["/bin/bash"]
ENTRYPOINT ["/entry/docker-entrypoint.sh"]
